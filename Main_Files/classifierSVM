import pega_dados_balanceados
import pandas as pd
from sklearn.svm import SVC
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.pipeline import Pipeline

def writeResult(score, allBalanced, balancedFile, notBalancedFile): 
    if(allBalanced == True):
        balancedFile.write(str(score)+"\n")
    else:
        notBalancedFile.write(str(score)+"\n")
    
balancedFile = open("ResultadosBalanceadosNB.txt", "w")
notBalancedFile = open("ResultadosDesbalanceadosNB.txt", "w")
totalScore = 0
i=0
boole = False
allBalanced = False
resp = input("Deseja dados balanceados? y/n \n")
while(i < 10):
    while(boole == False):       
        if(resp == "y"):
            #pego todos os dados de forma balanceada 50%-50%
            dados_treino, dados_test = pega_dados_balanceados.get_dados(pd.read_csv("comentarios.csv"), balanced = True)
            boole = True
            allBalanced = True
        elif(resp == "n"):
            #pega os dados desbalanceados
            dados_treino, dados_test = pega_dados_balanceados.get_dados(pd.read_csv("comentarios.csv"), balanced = False)
            boole = True
        else:
            boole = False
              
    #dados de treino
    x_treino = dados_treino["Comentário"]
    y_treino = dados_treino["Avaliação"]

    #dados de teste
    x_test = dados_test["Comentário"]
    y_test = dados_test["Avaliação"]

    #vetorização e escolhendo o classificador linear
    pipeline = Pipeline([
      ('counts', CountVectorizer()),
      ('classifier', SVC(kernel='linear',probability=True,random_state=1))
    ])
    pipeline.fit(x_treino, y_treino)
    #score linear
    score = pipeline.score(x_test, y_test)
    print(score)
    totalScore += score
    i += 1
    writeResult(score, allBalanced, balancedFile, notBalancedFile)
    allBalanced = False
    boole = False
average = totalScore / 10
balancedFile.close()
notBalancedFile.close()
print(average)
